version: "2.4"
services:
    odoo:
        extends:
            file: common.yaml
            service: odoo
        env_file:
            - .docker/odoo.env
            - .docker/db-access.env
        container_name: odoo
        restart: unless-stopped
        environment:
            DOODBA_ENVIRONMENT: "${DOODBA_ENVIRONMENT-prod}"
            INITIAL_LANG: "$INITIAL_LANG"
            LIST_DB: "true"
        depends_on:
            - db
        networks:
            default:
        ports:
            - "8069:8069"
        labels:
            traefik.longpolling.frontend.rule:
                "Host:${DOMAIN_PROD};PathPrefix:/longpolling/"
            traefik.www.frontend.rule: "Host:${DOMAIN_PROD}"
            traefik.alt.frontend.rule: "Host:${DOMAIN_PROD_ALT}"
            traefik.alt.frontend.redirect.regex:
                "^(.*)://${DOMAIN_PROD_ALT}/(.*)$$"
            traefik.alt.frontend.redirect.replacement:
                "$$1://${DOMAIN_PROD}/$$2"

    db:
        extends:
            file: common.yaml
            service: db
        env_file:
            - .docker/db-creation.env
        container_name: db
        restart: unless-stopped
        networks:
            default:
        ports:
            - "5432:5432"

networks:
    default:

volumes:
    filestore:
    db:
